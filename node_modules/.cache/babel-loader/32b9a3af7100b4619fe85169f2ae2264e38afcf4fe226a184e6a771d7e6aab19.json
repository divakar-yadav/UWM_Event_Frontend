{"ast":null,"code":"import{useParams,useNavigate}from'react-router-dom';import React,{useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const PrivateRoute=_ref=>{let{permissionCheckUrl,children,scoring_type}=_ref;const[isAuthenticated,setIsAuthenticated]=useState(false);const[isAuthorized,setIsAuthorized]=useState(true);const[isLoading,setIsLoading]=useState(true);const[navigationTarget,setNavigationTarget]=useState(null);const{posterId}=useParams();const navigate=useNavigate();useEffect(()=>{let ignore=false;async function checkAuth(){const response=await fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/home/validate_token/\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(localStorage.getItem(\"token\"))}});if(!ignore){if(response.status===200){setIsAuthenticated(true);if(permissionCheckUrl){const urlWithId=permissionCheckUrl.replace(\":id\",posterId);const response=await fetch(urlWithId+\"/checkforall?scoring_type=\".concat(scoring_type),{method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(localStorage.getItem(\"token\"))}});if(response.status===200){setIsAuthorized(true);}else{setIsAuthorized(false);}}}setIsLoading(false);}}checkAuth();return()=>{ignore=true;};},[permissionCheckUrl,posterId]);useEffect(()=>{if(!isLoading){if(!isAuthenticated){setNavigationTarget('/login');}else if(isAuthenticated&&!isAuthorized){setNavigationTarget('/');}}},[isLoading,isAuthenticated,isAuthorized]);useEffect(()=>{if(navigationTarget){navigate(navigationTarget);}},[navigationTarget,navigate]);console.log({isLoading,isAuthenticated,isAuthorized});if(isLoading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return children;};export default PrivateRoute;","map":{"version":3,"names":["useParams","useNavigate","React","useState","useEffect","jsx","_jsx","PrivateRoute","_ref","permissionCheckUrl","children","scoring_type","isAuthenticated","setIsAuthenticated","isAuthorized","setIsAuthorized","isLoading","setIsLoading","navigationTarget","setNavigationTarget","posterId","navigate","ignore","checkAuth","response","fetch","concat","process","env","REACT_APP_API_URL","method","headers","Authorization","localStorage","getItem","status","urlWithId","replace","console","log"],"sources":["/Users/divakaryadav/Documents/SRPC2025/UWM_Event_Frontend/src/PrivateRoute.js"],"sourcesContent":["import { useParams, useNavigate } from 'react-router-dom';\nimport React, { useState, useEffect } from 'react';\n\nconst PrivateRoute = ({ permissionCheckUrl, children, scoring_type }) => {\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [isAuthorized, setIsAuthorized] = useState(true);\n    const [isLoading, setIsLoading] = useState(true);\n    const [navigationTarget, setNavigationTarget] = useState(null);\n    const { posterId } = useParams();\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        let ignore = false;\n\n        async function checkAuth() {\n            const response = await fetch(`${process.env.REACT_APP_API_URL}/home/validate_token/`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n                },\n            });\n            if (!ignore) {\n                if (response.status === 200) {\n                    setIsAuthenticated(true);\n\n                    if (permissionCheckUrl) {\n                        const urlWithId = permissionCheckUrl.replace(\":id\", posterId);\n\n                        const response = await fetch(urlWithId + `/checkforall?scoring_type=${scoring_type}`, {\n                            method: \"GET\",\n                            headers: {\n                                \"Content-Type\": \"application/json\",\n                                Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n                            },\n                        });\n\n                        if (response.status === 200) {\n                            setIsAuthorized(true);\n\n                        } else {\n                            setIsAuthorized(false);\n                        }\n                    }\n                }\n                setIsLoading(false);\n            }\n        }\n\n        checkAuth();\n        return () => { ignore = true; };\n    }, [permissionCheckUrl, posterId]);\n\n    useEffect(() => {\n        if (!isLoading) {\n            if (!isAuthenticated) {\n                setNavigationTarget('/login');\n            } else if (isAuthenticated && !isAuthorized) {\n                setNavigationTarget('/');\n            }\n        }\n    }, [isLoading, isAuthenticated, isAuthorized]);\n\n    useEffect(() => {\n        if (navigationTarget) {\n            navigate(navigationTarget);\n        }\n    }, [navigationTarget, navigate]);\n    console.log({ isLoading, isAuthenticated, isAuthorized });\n    if (isLoading) {\n        return <div>Loading...</div>;\n    }\n    return children;\n};\n\nexport default PrivateRoute;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}